处理好异常状况是掌握一门编程语言的基础，也是我们编程离不开的基本功。

相信你对异常处理的机制已经很熟悉了。

异常处理便捷、灵活、好用。但是，越好用的东西，我们越容易忽视它的缺陷。

异常处理就有很多我们容易忽视的陷阱。今天，我们来聊聊这些问题，以及该怎么处理这些问题。

## 异常就是非正常
异常状况，就是不正常的状况。

异常状况的处理会让代码的效率变低。一个流畅的业务，它实现代码的执行路径，理想的状况就是没有任何异常状况发生。否则，业务执行的效率就会大打折扣。

既然这样，我们就不应该使用异常机制来处理正常的状况。这一点不难理解。

可是，由于一门语言无法理解什么样的状况是正常状况，什么样的状况又是异常状况，也就无法限制异常机制使用的具体场景。

所以作为程序员，我们需要自己解决好这个问题，不要滥用了异常机制。

比如说，很多 API 的设计有检查参数有效性的方法。如果参数通过检验，就没有异常抛出，否则就会抛出异常。在使用这个方法的代码时，我们需要检查有没有抛出异常来确认参数是否有效。
```
/**
 * Check if the user name is a registered name.        
 *
 * @throws IllegalArgumentException if the user name is invalid or
 *         not registered.
 */
void checkUserName(String userName) {
    // snipped
}
```
这是一个糟糕的设计！

在这个例子中，如果 userName 字符串不符合规范，这是一个异常状况；

如果 userName 不是一个注册用户，这通常是一个正常状况。 

在正常状况下使用异常处理，无疑会降低系统的效率，以及编码的效率。

**所以正常的状况和异常的状况一定要分开、分清，不能混用。**
   
```
/**
 * Check if the user name is a registered name.        
 *
 * @return true if the userName is a registered name.
 * @throws IllegalArgumentException if the user name is invalid
 */
boolean isRegisteredUser(String userName) {
    // snipped
}
```

## 分清异常的类别
我们上面讲了异常的一些基本概念，现在我们来讲讲异常的类别。
在 Java 语言里，异常状况分为三类。
+ 非正常异常（Error）：这类异常的命名以 Error 结尾，比如 OutOfMemoryError，NoSuchMethodError。这类异常，编译器编译时不检查，应用程序不需要处理，接口不需要声明，接口规范也不需要纪录；

+ 运行时异常（RuntimeException）：这类异常的命名通常以 Exception 结尾，比如 IllegalArgumentException，NullPointerException。这类异常，编译器编译时不检查，接口不需要声明，但是应用程序可能需要处理，因此接口规范需要记录清楚；

+ 非运行时异常：除了运行时异常之外的其他的正常异常都是非运行时异常，比如 InterruptedException，GeneralSecurityException。和运行时异常一样，命名通常以 Exception 结尾。这类异常，编译器编译时会检查异常是否已经处理或者可以抛出，接口需要声明，应用程序需要处理，接口规范需要记录清楚。


通常我们说的异常，指的是运行时异常和非运行时异常。

对于非正常异常，我们通常使用“错误”这个词汇而不是“异常”来表示。 由于非正常异常不需要特别处理，使用“错误”这个词汇，并不会导致使用方面的误导。

非运行时异常还有一个别名，叫作检查型异常（CheckedException）。

对应地，运行时异常的别名是非检查型异常（UncheckedException）。

为了便于识别，我们通常使用检查型异常指代非运行时异常，使用运行时异常指代非检查型异常。

![[Pasted image 20240905112232.png]]


对于函数出错返回数据类型，我总结了 4 种情况，它们分别是：
+ 错误码、
+ NULL 值、
+ 空对象、
+ 异常对象。

### 1. 返回错误码
C 语言没有异常这样的语法机制，返回错误码便是最常用的出错处理方式。而 Java、Python 等比较新的编程语言中，大部分情况下，我们都用异常来处理函数出错的情况，极少会用到错误码。
### 2. 返回 NULL 值
在多数编程语言中，我们用 NULL 来表示“不存在”这种语义。对于查找函数来说，数据不存在并非一种异常情况，是一种正常行为，所以返回表示不存在语义的 NULL 值比返回异常更加合理。

### 3. 返回空对象
返回 NULL 值有各种弊端，对此有一个比较经典的应对策略，那就是应用空对象设计模式。当函数返回的数据是字符串类型或者集合类型的时候，我们可以用空字符串或空集合替代 NULL 值，来表示不存在的情况。这样，我们在使用函数的时候，就可以不用做 NULL 值判断。

### 4. 抛出异常对象
尽管前面讲了很多函数出错的返回数据类型，但是，最常用的函数出错处理方式是抛出异常。异常有两种类型：受检异常和非受检异常。

对于应该用受检异常还是非受检异常，网上的争论有很多，但也并没有一个非常强有力的理由，说明一个就一定比另一个更好。所以，我们只需要根据团队的开发习惯，在同一个项目中，制定统一的异常处理规范即可。

对于函数抛出的异常，我们有三种处理方法：直接吞掉、直接往上抛出、包裹成新的异常抛出。


## 小结
今天我给你讲了处理异常的一些情况，它的小陷阱很多。单就编写规范的代码来说，我们要记住三条准则：
+ 不要使用异常机制处理正常业务逻辑；
+ 异常的使用要符合具体的场景；
+ 具体的异常要在接口规范中声明和标记清楚。