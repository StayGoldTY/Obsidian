## 整数运算，可能溢出,该怎么避免这类错误？
### 1.比较运算，选择“比较小的数”。
如果表达式出现在比较运算符的两侧，选择产生较小的数的运算。比如下面这段代码：
```
// a, b, c are positive integers
if (a < (b + c)) {    // (b + c) can overflow
    // snipped
}
 
// a, b, c are positive integers
if ((a - b) < c) {    //  no overflow
    // snipped
}
```
这个例子适用于正数的运算，如果是负数呢？ 如果不确定是整数还是负数，该怎么办？这个问题，我留给你去思考。
***
在处理带有符号的整数运算时，尤其是当你不确定变量是正数还是负数时，可能会遇到溢出或逻辑错误的风险。对于你的问题，如果 `a`、`b`、`c` 可能是负数，原来的两个条件判断逻辑会有所不同。

### 例子中提到的两种情况分析：

1. **第一种情况：`if (a < (b + c))`**
   - 当 `a`、`b`、`c` 都是正数时，`b + c` 可能会导致溢出，因为整数的范围有限（例如，32 位的 `int` 范围是 `-2^31` 到 `2^31 - 1`）。如果 `b + c` 溢出，则可能会导致错误的比较结果。
   - 如果 `b` 或 `c` 是负数，则溢出的风险较小，但你仍需小心负数相加后的结果。

2. **第二种情况：`if ((a - b) < c)`**
   - 这里的减法通常比加法更安全，因为减法不会导致正数的溢出（除非 `a` 和 `b` 特别接近 `Integer.MIN_VALUE`，导致负数溢出）。当 `a`、`b`、`c` 都是正数时，这种情况下不容易溢出。

### 如果 `a`、`b`、`c` 可能为负数：

负数的存在可能会对条件判断逻辑产生影响。负数的加法和减法需要考虑符号问题，不仅是溢出，甚至逻辑判断也可能变得不正确。

#### 处理方法：

1. **避免溢出的安全处理：**
   在进行加法时，为了防止溢出，通常可以用更大的数据类型处理（例如，从 `int` 升级到 `long` 或 `BigInteger`），或者使用针对溢出情况的检查逻辑。例如：

   ```java
   if (b > 0 && c > 0 && b > Integer.MAX_VALUE - c) {
       // b + c 会溢出
   }
   ```

   在计算 `b + c` 前，先检查是否即将溢出。如果 `b + c` 可能超出 `int` 的最大值 `Integer.MAX_VALUE`，则可以采取相应措施。

2. **正确处理符号的逻辑：**
   如果 `a`、`b`、`c` 可能为负数，在逻辑判断时需要额外考虑符号的影响。例如，负数的加法和减法可能会改变运算的预期结果。比如：

   ```java
   if ((long)a < (long)(b + c)) {  // 转为long，防止溢出
       // snipped
   }
   ```

   将变量转换为更大范围的类型（如 `long`）可以防止溢出，并确保计算结果的正确性。

3. **使用标准库来处理溢出：**
   Java 提供了 `Math.addExact()` 和 `Math.subtractExact()` 等方法，这些方法会在发生溢出时抛出 `ArithmeticException`，这样你可以在程序中捕获异常并做相应处理。

   ```java
   try {
       if (a < Math.addExact(b, c)) {
           // 处理不溢出的情况
       }
   } catch (ArithmeticException e) {
       // 处理溢出情况
   }
   ```

4. **检查符号：**
   如果不确定 `a`、`b`、`c` 的符号，可以先检查它们是否为负数，并根据它们的符号决定如何处理逻辑。你可以通过以下方法检查正负号：

   ```java
   if (a < 0 || b < 0 || c < 0) {
       // 处理负数的情况
   } else {
       // 处理正数的情况
   }
   ```

### 总结：

1. **避免溢出：** 可以通过提升数据类型（例如使用 `long`）或手动检查溢出风险来处理。
2. **正确处理符号：** 当你不确定输入的正负时，确保在逻辑判断中正确处理正负数，避免出现意外的符号错误。
3. **使用库函数：** Java 的 `Math.addExact()` 和 `Math.subtractExact()` 等方法能够检测并抛出溢出异常，帮助防止溢出导致的错误。

通过这些措施，你可以确保无论输入是正数还是负数，都能正确处理逻辑判断，并避免溢出问题。
***

## 小结
通过对这个评审案例的讨论，我想和你分享下面几点个人看法。
+ 数值运算，理论结果可能会超出数值类型许可的空间，进而发生实际结果的溢出。
+ 抽象的数据一旦有了现实意义，便有了具体的现实约束，我们一定要考虑这些约束。
+ 很多问题和我们的习惯并不相符，要通过制度设置来减少由于人的固有缺陷带来的经常性问题。