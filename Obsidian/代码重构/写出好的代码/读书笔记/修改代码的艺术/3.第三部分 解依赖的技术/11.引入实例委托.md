**25.11** **引入实例委托**

人们会因为各种各样的原因使用静态方法。其中最常见的原因便是为了实现单件模式(293 页)。而另一个常见的原因是使用静态方法来创建实用类。

实用类在许多设计中都是一眼就能看出来的。它们一般没有任何实例变量和实例方法。而是全部由静态方法和静态常量组成。

同样，人们也会出于各种各样的原因而创建实用类。大多数时候是因为无法为一组方法寻找出合适的公共抽象。比如JDK中的Math 类。Math 内有计算三角函数的静态方法 (cos,sin,tan),

但除此之外还有许多其他方法。当语言设计者从对象开始一路往下构建他们的语言时，应确保基 本的数值对象知道如何进行这些操作。如，你应当能够对“1”这个对象调用sin()   方法，并获 得正确的正弦值。在本书写作的时候， Java尚不支持在基本类型上调用数学方法，因此实用类是 个正当的解决方案，但它同时也是个特例。在几乎所有的情况下，你也可以使用传统的带有实例 数据和方法的类来完成工作。

如果你的项目中有静态方法，则很可能它们并不会给你带来麻烦，除非其中包含了一些你没法或不想在测试的时候依赖的东西。(这个的技术术语叫做“静态粘着”。)遇到这类情况，你可   能会想：“唉，要是有对象接缝(35页)就好了，那样的话就可以利用它来嵌入测试用的行为了。” 那么,到底怎么办呢?

方案之一便是往目标类上引入委托实例方法。这时候，你需要想办法将对那些静态方法的调用替换为对目标类的实例方法的调用。例如：
![[Pasted image 20240524151845.png]]
我们添加的那个实例方法叫updateBalance,它只是简单地将调用转发至静态方法updateAccountBalance。
这么一来，我们便可以将对updateAccountBalance的调用：
![[Pasted image 20240524152003.png]]注意，只有当我们有办法在外部创建一个BankingServices      对象从而能通过该对象来调用 someMethod  时，该做法才能成功。这就意味着我们需要做一些额外的重构，不过，在静态类型 的语言里，可以依靠编译器(251页)来帮我们将对象放置到位。

对于许多静态方法来说，该技术还算是相当直观的。然而当遇到实用类的时候，你可能就 会感觉不自然了。 一个具有5到10个静态方法，却只有一两个实例方法的类看起来的确挺怪异 的。而如果这仅有的两个实例方法还只是一层空壳，其功能只是将任务简单地转发给相应的静 态方法，那就更加怪异了。但好处是，该技术引入了对象接缝，后者使你能够在测试时替换进 另一种行为。随着时间的推移，你可能就会发现每个对该类的方法的调用都通过实例方法进行 转发了，这时候你便可以将那些静态方法的方法体转移到相应的实例方法中，并删除所有静态方法了。

**步** **骤
引入实例委托 (Introduce  Instance  Delegator) 手法的步骤如下：
(1)找出会在测试中带来问题的那个静态方法。
(2)在它所属类上新建一个实例方法(记得用签名保持手法)。让该实例方法委托那个静态 方法。
(3)找出你想要纳入测试的类中有哪些地方使用了那个静态方法。使用参数化方法(301页)

或其他解依赖技术来提供一个实例给代码中想要调用那个静态方法的地方(即改为从该实例间接